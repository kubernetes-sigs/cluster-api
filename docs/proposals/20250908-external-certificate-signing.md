---
title: External CA and external certificate signing in KCP/CABPK
authors:
  - "@moh2a"
reviewers:
  - ""
creation-date: 2025-09-07
last-updated: 2025-09-08
status: provisional
---

# Title

Enabling Kubeadm provider to integrate with External CA and delegate certificate signing

## Table of Contents

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

- [Glossary](#glossary)
- [Summary](#summary)
- [Motivation](#motivation)
  - [Goals](#goals)
  - [Non-Goals/Future Work](#non-goalsfuture-work)
- [Proposal](#proposal)
  - [User Stories](#user-stories)
    - [Story 1](#story-1)
    - [Story 2](#story-2)
  - [Security Model](#security-model)
- [Upgrade Strategy](#upgrade-strategy)
- [Implementation History](#implementation-history)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## Glossary

Refer to the [Cluster API Book Glossary](https://cluster-api.sigs.k8s.io/reference/glossary.html).

### External CA

An External Certificate Authority (CA) is a CA that exists outside the Cluster API (CAPI) management plane. Instead of having Kubeadm generate and manage its own self-signed CA for cluster components (such as kube-apiserver, kubelet, and etcd), an external CA can be integrated to provide trusted root certificates. This is typically used in environments where certificate lifecycles are centrally managed for compliance, auditing, or security policy reasons.
Today, only "Custom CA" is supported in CAPI [Custom CA](https://cluster-api.sigs.k8s.io/tasks/certs/using-custom-certificates#using-custom-certificates).

### External certificate signing

External certificate signing is the process of delegating certificate issuance to a signing service instead of relying on self-signed certificates generated by KCP/CABPK or another [bootstrap provider](https://cluster-api.sigs.k8s.io/reference/glossary.html#bootstrap-provider). Under this model, Cluster API delegates the provisioning and management of signed certificates to external systems or users. This approach ensures that certificates are issued by a trusted external CA, while the surrounding automation (or the platform integrator) takes charge of the end-to-end lifecycle, including secure delivery and timely rotation.

## Summary

This proposal introduces the ability for Kubeadm/KCP to integrate with external Certificate Authorities (CAs), meaning that CA key never leaves the external system. It also supports external certificate signing, where all certificate issuance is delegated externally. Cluster components generate Certificate Signing Requests (CSRs) that are signed by the external CA, providing a centralized and consistent trust chain across cluster bootstrap and lifecycle operations.

With this approach, the KCP/CABPK user is responsible for setting up a system to provide signed certificates, coordinate signing with the external CA, and manage certificate rotation over time. This enables integration with enterprise PKI systems, enforces organizational security policies, and ensures compliance with regulatory requirements while maintaining secure communication between cluster components.

## Motivation

The current design of KCP/CABPK, which leverages self-signed certificates generated within the management cluster, offers a highly automated and self-contained lifecycle for clusters. This approach is widely accepted as it provides a robust security baseline when combined with proper access control on the management cluster and secure handling of machine userdata.

However, for organizations with stricter security requirements or those operating in multi-tenant environments where management cluster isolation is harder to enforce, the current model presents specific trade-offs:

- Key exposure in the management cluster: Anyone with access to the management cluster's Secrets has access to the CA keys.
- Key transit over cloud-init: The CA private keys travel over cloud-init user data during control plane provisioning, which could be intercepted or leaked.
- Privilege escalation risk: With access to CA keys, an attacker can sign admin or superadmin certificates, gaining full control over clusters and workloads.

In a default configuration, Kubernetes with kubeadm generates generate and store CA keys locally on the control plane nodes. This also represents a security risk because compromise of a control plane node could allow signing of highly privileged certificates.

By integrating external CAs and delegating certificate signing externally:

- CA keys never leave the external system, removing the risk of compromise through the management cluster or cloud-init.
- KCP/CABPK users can implement centralized enterprise PKI practices, ensuring strict access control and auditability for certificate issuance.
- Overall trust in cluster bootstrap and lifecycle operations is increased, mitigating a high-impact attack vector that currently exists in default Kubernetes deployments and, by extension, Cluster API workload cluster.

This proposal addresses a critical security gap, providing users with a mechanism to eliminate CA key exposure while maintaining full Kubernetes functionality.

### Goals

- Enable KCP/CABPK to integrate with external Certificate Authorities (CAs) where CA private keys never leave the external system.
- Make possible to use external certificate signing for cluster components (control plane and nodes), delegating certificate issuance to an external CA or signing service. This allows users to implement their own PKI workflow, including certificate provisioning, signing, and rotation, while maintaining secure cluster bootstrap and lifecycle operations.
- Reduce the attack surface related to CA key exposure during cluster bootstrap and management.

### Non-Goals/Future Work

- Kubeadm will not provide a built-in external CA service; users remain responsible for setting up and managing the external CA.
- This feature does not replace existing certificate management solutions such as cert-manager; rather, it provides a mechanism to integrate them.
- This proposal does not modify Kubernetes internal certificate signing behavior beyond enabling delegation to an external authority.
- The automated rotation of the Certificate Authorities themselves is not in scope for this proposal.
- This proposal does not protect against all damages if an attacker gains access to the management cluster, control plane nodes, or cluster admin credentials.
- This proposal does not protect against all damages if an attacker gains access to the management cluster, control plane nodes, or cluster admin credentials.
- The management of the Service Account (SA) key pair is not covered by this proposal and remains handled by the existing logic.

## Proposal

To support external CAs in KCP/CABPK, this proposal introduces a spec-level field `externalCA` in the KubeadmControlPlane resource. This field indicates that the cluster should operate in "external CA mode" and is gated by a feature flag to track its progression from Alpha → Beta → GA.

```
// externalCA enables external CA mode for the cluster.
// When enabled, CA keys are not stored or validated in the management cluster's secrets.
ExternalCA *bool `json:"externalCA,omitempty"`
```

Key aspects of the proposal:

### Affected Certificates Overview

The following table summarizes the certificates impacted by the external CA mode:

| Certificate / Key Pair    | Responsibility  | Scope         | Location           | Logic / Mechanism                                |
| :------------------------ | :-------------- | :------------ | :----------------- | :----------------------------------------------- |
| **Cluster CA**            | External system | KCP           | Management Cluster | Key in external system; Cert in Secret           |
| **Etcd CA**               | External system | KCP           | Management Cluster | Key in external system; Cert in Secret           |
| **Front Proxy CA**        | External system | KCP           | Management Cluster | Key in external system; Cert in Secret           |
| **Etcd Client Cert**      | External system | KCP           | Management Cluster | Provided via Secret (for stacked etcd)           |
| **Kubeconfig Admin Cert** | External system | CAPI Contract | Management Cluster | Provided via Secret                              |
| **Controlplane Certs**    | External system | CABPK         | Controlplane node  | Provisioned during bootstrap                     |
| **Kubelet Cert**          | External system | CABPK         | node               | Handled via Kubernetes CSR API and custom signer |

### External CA mode

When the flag is explicitly enabled, CA keys are no longer required in the CAPI management cluster and must not be stored or validated in secrets. By default, this feature remains disabled to avoid impacting users who do not rely on external CAs.
KCP/CABPK will not generate or manage CA private keys. The CA certificates needs to be provided by the user or an external system in Kubernetes secrets with the following naming convention:

- `<cluster-name>-etcd`
- `<cluster-name>-ca`
- `<cluster-name>-proxy`

Each Secret should follow this Kubernetes format:

```
apiVersion: v1
kind: Secret
metadata:
  name: <cluster-name>-<etcd|ca|proxy>
type: Opaque
data:
  ca.crt: <base64-encoded-CA-certificate>
```
KCP/CABPK should wait for the CA certificates if they are not already provided. KCP/CABPK must not adopt these Secrets, as they are the responsibility of the user.

### Certificates necessary to KCP/CABPK

#### Kubeadm and KCP requirements

The management of Certificate Authorities and internal component certificates falls under the scope of KCP and CABPK. KCP will not generate these keys in external CA mode and expects the user to provide the following secrets:

- **Certificate Authorities:** The cluster CA, etcd CA, and front-proxy CA must be provided as secrets.
- **Etcd Client Certificate:** For clusters using stacked etcd, the user must provide the etcd client certificate in a secret named `<cluster-name>-apiserver-etcd-client`. For external etcd, KCP follows the existing logic for external etcd connectivity.

#### Cluster API Contract and Kubeconfig

The admin certificate used for the cluster kubeconfig is a core Cluster API requirement. This proposal adheres to the [Cluster API Control Plane Contract](https://cluster-api.sigs.k8s.io/developer/providers/contracts/control-plane#cluster-kubeconfig-management) by delegating the issuance of the `<cluster-name>-admin` secret to an external system while maintaining standard naming conventions. This ensures compatibility with the broader CAPI ecosystem.
Certificates such as the etcd client certificate and the admin certificate for the kubeconfig are normally generated by KCP/CABPK. In external CA mode, these certificates are still needed, but their provisioning and lifecycle management become the responsibility of the user.

Kubeadm controllers will verify the presence and validity of external certificates using **two distinct conditions** on the `KubeadmControlPlane` resource:

#### `ExternalCAsReady`

- **Covers:** CA certificates: etcd CA, cluster CA, and proxy CA.
- **Status:** Set to `False` if any required CA Secret is missing or invalid.
- **Reasons and Messages:**
  - `MissingSecret`, "The following required CA Secrets are missing: `<list-of-missing-secrets>`."
  - `InvalidCertificate`, "The following CA certificates are invalid or could not be parsed: `<list-of-invalid-certificates>`."
- **Purpose:** Allows users to quickly detect problems with the foundational CAs before provisioning workloads.

#### `ExternalClientCertificatesReady`

- **Covers:** Client certificates: etcd client certificate and kubeconfig admin certificate.
- **Status:** Set to `False` if any required client certificate Secret is missing or invalid.
- **Reasons and Messages:**
  - `MissingSecret`, "The following required client certificate Secrets are missing: `<list-of-missing-secrets>`."
  - `InvalidCertificate`, "The following client certificates are invalid or could not be parsed: `<list-of-invalid-certificates>`."
- **Purpose:** Provides clear visibility into whether client access to the cluster components is ready.

### Kubeadm Bootstrap: ClusterConfiguration and InitConfiguration

When using Kubeadm bootstrap, the command kubeadm certs generate-csr requires a configuration file containing ClusterConfiguration and/or InitConfiguration. Currently these files are only provided to the initialization control plane.
These configurations must be provided to joining control plane nodes because they contain the necessary information to generate Certificate Signing Requests (CSRs) for their components. The joining control plane nodes will generate CSRs locally and submit them to the external CA or user-provided signing system.

Below the workflow that describe this proposal.

![workflow](images/external-cert-sign/workflow.png)

### User Stories

#### Enterprise PKI Integration

As a KCP/CABPK user in an enterprise environment, I want to delegate certificate signing to our corporate CA, so that CA keys never reside in the management cluster and certificate issuance complies with organizational security policies.

#### Flexible Bootstrap Provider Support

As a KCP/CABPK user I want that it provides all necessary configuration to bootstrap providers to be compatible with external signing, so that I can maintain secure certificate flows regardless of the underlying bootstrap mechanism.

### Security Model

The External CA / External Certificate Signing feature is designed to minimize exposure of CA private keys and improve the overall security posture of Cluster API clusters. The security model includes the following key points:

- CA private keys never leave the external CA system.
- Cluster API and management clusters do not store CA keys in secrets.

## Upgrade Strategy

The `externalCA` feature can be enabled on an existing cluster that was originally created with the default internal CA, but it requires careful manual steps by the user. Cluster API does not automatically rotate or migrate CAs.

### Migrating from internal CA to external CA

To switch an existing cluster from the internal CA workflow to `externalCA` mode, the user must:

1. **Backup the existing internal CAs**: save the current cluster CA, etcd CA, and proxy CA certificates and keys.
2. **Create client certificate Secrets**: generate and create the required Secrets for the etcd client and kubeconfig admin certificates:
   - `<cluster-name>-apiserver-etcd-client`
   - `<cluster-name>-admin`
3. **Enable the `externalCA` flag**: update the cluster configuration to activate the external CA workflow.
4. **Remove private keys from the Secrets**: the `.key` entries can be removed from CA Secrets.

After completing these steps, Cluster API will start using the external CA certificates while the existing cluster remains functional. The user can also perform a CA rotation if desired.

### Migrating from external CA to internal CA

To switch a cluster from `externalCA` back to the internal CA workflow, the user must:

1. **Create CA Secrets**: provide the required CA certificates and keys for KCP/CABPK adoption:
   - `<cluster-name>-ca` (cluster CA)
   - `<cluster-name>-etcd` (etcd CA)
   - `<cluster-name>-proxy` (proxy CA)
2. **Update the cluster configuration**: disable the `externalCA` flag.

KCP/CABPK will then adopt the provided CA certificates and resume internal CA management. Existing client certificates (etcd client, kubeconfig admin) are no longer required and will be ignored.

## Additional Details

## Implementation History

- [x] 08/05/2025: Proposed idea in an issue
- [x] 09/03/2025: First round of feedback from community
- [x] 09/08/2025: Open proposal PR
- [x] 24/09/2025: Present proposal at a [community meeting]

<!-- Links -->

[community meeting]: https://docs.google.com/document/d/1ushaVqAKYnZ2VN_aa3GyKlS4kEd6bSug13xaXOakAQI/edit#heading=h.pxsq37pzkbdq
